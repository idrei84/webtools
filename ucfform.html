<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI as the Democratic Tutor: Dialogue Designer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
        }
        .tagline {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-style: italic;
        }
        .form-section {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input[type="text"], 
        input[type="email"], 
        textarea, 
        select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        .checkbox-group {
            margin-bottom: 15px;
        }
        .checkbox-option {
            margin-bottom: 5px;
        }
        .checkbox-option label {
            font-weight: normal;
            display: inline;
            margin-left: 5px;
        }
        button {
            background-color: #2c3e50;
            color: white;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            width: 100%;
            border-radius: 4px;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #1a252f;
        }
        .instructions {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 25px;
        }
        .hidden {
            display: none;
        }
        .bloom-box {
            background-color: #f7f9fe;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 20px;
        }
        .dialog-box {
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .student-query {
            background-color: #e1f5fe;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
        }
        .ai-response {
            background-color: #f0f4c3;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
        }
        .meta-prompt {
            background-color: #e8eaf6;
            border-left: 4px solid #5c6bc0;
            padding: 10px;
            margin: 10px 0;
        }
        .add-component-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
            width: auto;
            font-size: 14px;
        }
        .component-container {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        .remove-component {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: #f9f9f9;
            border-color: #ddd;
            border-bottom-color: #f9f9f9;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>AI as the Democratic Tutor</h1>
    <div class="tagline">Design structured AI tutoring dialogues to democratize access to personalized learning</div>
    
    <div class="instructions">
        <div class="bloom-box">
            <h3>The 2 Sigma Problem & AI Tutoring</h3>
            <p>In 1984, educational researcher Benjamin Bloom demonstrated that one-on-one tutoring improved student performance by two standard deviations (the "2 Sigma Problem") compared to conventional instruction. However, providing human tutors for every student has been economically unfeasible—until now.</p>
            <p>AI tutors can democratize access to personalized learning by providing 24/7 guidance, adapted to individual needs, across all disciplines. This tool helps you design structured AI tutoring dialogues that scaffold student learning while developing their skills in effectively engaging with AI.</p>
        </div>
        <p>This dialogue designer helps educators create scaffolded AI tutoring experiences that guide students to engage with AI as a learning partner rather than simply an answer provider. Each dialogue template includes structured interactions, metacognitive prompts, and knowledge application opportunities.</p>
    </div>

    <div class="tabs">
        <div class="tab active" data-tab="design">Design Tutoring Dialogue</div>
        <div class="tab" data-tab="preview">Preview</div>
    </div>
    
    <div class="tab-content active" id="design-tab">
        <form id="tutorDialogueForm">
            <!-- Tutoring Context -->
            <div class="form-section">
                <h2>Tutoring Context</h2>
                
                <label for="dialogueTitle">Tutoring Dialogue Title:</label>
                <input type="text" id="dialogueTitle" placeholder="e.g., Critical Analysis of Research Studies" required>
                
                <label for="courseInfo">Course Information:</label>
                <input type="text" id="courseInfo" placeholder="e.g., COMM 301: Advanced Communication Theory">
                
                <label for="disciplineArea">Discipline Area:</label>
                <select id="disciplineArea" required>
                    <option value="">-- Select Discipline --</option>
                    <option value="arts-humanities">Arts & Humanities</option>
                    <option value="business">Business</option>
                    <option value="communication">Communication</option>
                    <option value="education">Education</option>
                    <option value="engineering">Engineering</option>
                    <option value="health-sciences">Health Sciences</option>
                    <option value="natural-sciences">Natural Sciences</option>
                    <option value="social-sciences">Social Sciences</option>
                    <option value="other">Other (specify below)</option>
                </select>
                <input type="text" id="otherDiscipline" placeholder="Specify discipline if 'Other'" style="display: none;">
                
                <label for="learningChallenges">Learning Challenges Addressed:</label>
                <textarea id="learningChallenges" placeholder="What specific learning challenges or obstacles will AI tutoring help students overcome?" required></textarea>
                
                <label for="learningObjectives">Learning Objectives:</label>
                <textarea id="learningObjectives" placeholder="List the specific learning objectives this tutoring dialogue addresses" required></textarea>
            </div>
            
            <!-- AI Tutoring Platform -->
            <div class="form-section">
                <h2>AI Tutoring Platform</h2>
                
                <label>Recommended AI Tutoring Platforms:</label>
                <div class="checkbox-group">
                    <div class="checkbox-option">
                        <input type="checkbox" id="tool-claude" name="aiTools" value="Claude (Anthropic)">
                        <label for="tool-claude">Claude (Anthropic) - Strong for nuanced discussions, ethical considerations</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="tool-chatgpt" name="aiTools" value="ChatGPT (OpenAI)">
                        <label for="tool-chatgpt">ChatGPT (OpenAI) - Good general-purpose tutor with wide knowledge</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="tool-gemini" name="aiTools" value="Gemini (Google)">
                        <label for="tool-gemini">Gemini (Google) - Strong for visual learning and explanations</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="tool-copilot" name="aiTools" value="Microsoft Copilot">
                        <label for="tool-copilot">Microsoft Copilot - Good integration with Office tools for projects</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="tool-other" name="aiTools" value="Other">
                        <label for="tool-other">Other</label>
                        <input type="text" id="otherToolInput" placeholder="Specify other AI tools" style="display:none; width:50%; margin-left:10px;">
                    </div>
                </div>
                
                <label for="platformRationale">Platform Selection Rationale:</label>
                <textarea id="platformRationale" placeholder="Why are these AI tutoring platforms appropriate for addressing the identified learning challenges?"></textarea>
            </div>
            
            <!-- Pre-Assessment -->
            <div class="form-section">
                <h2>Pre-Learning Assessment</h2>
                <p>Design an initial assessment to help the AI tutor understand what students already know and where they need support.</p>
                
                <label for="preAssessmentGoals">Assessment Goals:</label>
                <textarea id="preAssessmentGoals" placeholder="What does the AI tutor need to understand about the student's current knowledge and skills?"></textarea>
                
                <label for="assessmentPrompts">Assessment Prompts:</label>
                <textarea id="assessmentPrompts" placeholder="List 3-5 questions the AI tutor should ask to gauge student understanding (one per line)"></textarea>
                
                <label for="assessmentInstructions">Instructions for Students:</label>
                <textarea id="assessmentInstructions" placeholder="How should students approach this assessment? What should they know about its purpose?"></textarea>
            </div>
            
            <!-- Tutoring Dialogue Structure -->
            <div class="form-section">
                <h2>Tutoring Dialogue Structure</h2>
                <p>Design the structure of the AI tutoring dialogue. Include student prompts, expected AI responses, and metacognitive questions.</p>
                
                <!-- Sample dialogue module for inspiration -->
                <div class="dialog-box">
                    <h3>Sample Dialogue Module: Concept Explanation</h3>
                    
                    <div class="student-query">
                        <strong>Student:</strong> I'm struggling to understand the difference between correlation and causation in research. Can you explain it?
                    </div>
                    
                    <div class="ai-response">
                        <strong>AI Tutor:</strong> I'd be happy to explain the difference between correlation and causation! 
                        
                        <p>Correlation means two variables change together in a pattern. For example, ice cream sales and swimming pool visits both increase in summer. They're correlated, but one doesn't cause the other.</p>
                        
                        <p>Causation means one variable directly causes a change in another. For example, applying heat to water causes it to boil.</p>
                        
                        <p>What makes this distinction challenging in your current studies?</p>
                    </div>
                    
                    <div class="student-query">
                        <strong>Student:</strong> I see the difference, but I'm not sure how to identify when a research paper is claiming correlation versus causation.
                    </div>
                    
                    <div class="ai-response">
                        <strong>AI Tutor:</strong> That's an excellent question! Researchers use specific language and research designs to indicate causation vs. correlation.
                        
                        <p>Look for these clues:</p>
                        <ul>
                            <li>Words like "associated with," "related to," or "linked to" suggest correlation</li>
                            <li>Words like "causes," "leads to," or "results in" suggest causation</li>
                            <li>Experimental designs with random assignment typically test causation</li>
                            <li>Observational or survey research typically establishes correlation</li>
                        </ul>
                        
                        <p>Let's practice with an example. Here's a research finding: "Students who eat breakfast show higher test scores." Is this claiming correlation or causation?</p>
                    </div>
                    
                    <div class="meta-prompt">
                        <strong>Metacognitive Prompt:</strong> Before responding, think about what additional information you would need to determine if this relationship is causal. What alternative explanations might exist?
                    </div>
                </div>
                
                <label for="dialogueModules">Dialogue Modules (topics to cover):</label>
                <textarea id="dialogueModules" placeholder="List the key concepts or topics this tutoring dialogue should address (one per line)"></textarea>
                
                <div class="component-container">
                    <h3>Dialogue Module 1</h3>
                    
                    <label for="module1Title">Module Title:</label>
                    <input type="text" id="module1Title" placeholder="e.g., Understanding Core Concepts">
                    
                    <label for="initialStudentPrompt">Initial Student Query:</label>
                    <textarea id="initialStudentPrompt" placeholder="What question or statement might the student begin with?"></textarea>
                    
                    <label for="aiResponseGuidance">AI Response Guidance:</label>
                    <textarea id="aiResponseGuidance" placeholder="How should the AI tutor respond? What key points should it cover? What questions should it ask to engage the student further?"></textarea>
                    
                    <label for="followupPrompts">Potential Follow-up Queries:</label>
                    <textarea id="followupPrompts" placeholder="What follow-up questions might students ask? (one per line)"></textarea>
                    
                    <label for="metacognitivePrompts">Metacognitive Prompts:</label>
                    <textarea id="metacognitivePrompts" placeholder="Questions that help students reflect on their thinking process (one per line)"></textarea>
                    
                    <button type="button" class="add-component-btn">+ Add Another Dialogue Module</button>
                </div>
            </div>
            
            <!-- Knowledge Application -->
            <div class="form-section">
                <h2>Knowledge Application</h2>
                <p>Design activities where students apply what they've learned through the AI tutoring dialogue.</p>
                
                <label for="applicationDescription">Application Activity Description:</label>
                <textarea id="applicationDescription" placeholder="Describe an activity where students apply their learning from this tutoring dialogue"></textarea>
                
                <label for="applicationInstructions">Instructions for Students:</label>
                <textarea id="applicationInstructions" placeholder="Detailed instructions for completing the application activity"></textarea>
                
                <label for="applicationTutor">Role of AI Tutor in Application:</label>
                <textarea id="applicationTutor" placeholder="How should students engage with the AI tutor during the application activity? What guidance or feedback should they seek?"></textarea>
            </div>
            
            <!-- Post-Assessment -->
            <div class="form-section">
                <h2>Post-Learning Assessment</h2>
                <p>Design an assessment to measure learning gains from the AI tutoring dialogue.</p>
                
                <label for="postAssessmentGoals">Assessment Goals:</label>
                <textarea id="postAssessmentGoals" placeholder="What specific learning gains should this assessment measure?"></textarea>
                
                <label for="postAssessmentPrompts">Assessment Prompts:</label>
                <textarea id="postAssessmentPrompts" placeholder="List 3-5 questions or tasks to measure learning gains (one per line)"></textarea>
                
                <label for="studentReflection">Student Reflection Prompts:</label>
                <textarea id="studentReflection" placeholder="Questions that help students reflect on what they've learned and how AI tutoring helped them (one per line)"></textarea>
            </div>
            
            <!-- Tutoring Relationship Guidelines -->
            <div class="form-section">
                <h2>Tutoring Relationship Guidelines</h2>
                
                <label for="studentAgency">Student Agency Guidelines:</label>
                <textarea id="studentAgency" placeholder="How should students maintain ownership of their learning while working with the AI tutor?"></textarea>
                
                <label for="ethicalGuidelines">Ethical Guidelines:</label>
                <textarea id="ethicalGuidelines" placeholder="Ethical considerations for the AI tutoring relationship (e.g., avoiding dependency, ensuring academic integrity)"></textarea>
                
                <label for="attributionGuidelines">Attribution Guidelines:</label>
                <textarea id="attributionGuidelines" placeholder="How should students attribute insights gained from AI tutoring in their academic work?"></textarea>
            </div>
            
            <!-- Generate Button -->
            <button type="submit" id="generateBtn">Generate AI Tutoring Dialogue</button>
        </form>
    </div>
    
    <div class="tab-content" id="preview-tab">
        <div class="form-section">
            <h2 id="previewTitle">Tutoring Dialogue Preview</h2>
            <div id="previewContent">
                <p class="preview-placeholder">Complete the form to see your tutoring dialogue preview</p>
            </div>
            
            <button id="downloadBtn">Download Tutoring Dialogue (PDF)</button>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab functionality
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs and content
                    document.querySelectorAll('.tab, .tab-content').forEach(el => {
                        el.classList.remove('active');
                    });
                    
                    // Add active class to clicked tab and corresponding content
                    this.classList.add('active');
                    document.getElementById(`${this.dataset.tab}-tab`).classList.add('active');
                    
                    // If preview tab is clicked, generate the preview
                    if (this.dataset.tab === 'preview') {
                        generatePreview();
                    }
                });
            });
            
            // Show/hide other discipline input
            document.getElementById('disciplineArea').addEventListener('change', function() {
                const otherInput = document.getElementById('otherDiscipline');
                otherInput.style.display = this.value === 'other' ? 'block' : 'none';
                otherInput.required = this.value === 'other';
            });
            
            // Show/hide other tool input
            document.getElementById('tool-other').addEventListener('change', function() {
                document.getElementById('otherToolInput').style.display = this.checked ? 'inline-block' : 'none';
            });
            
            // Add component button functionality
            document.querySelectorAll('.add-component-btn').forEach(button => {
                button.addEventListener('click', function() {
                    addComponent(this.dataset.type);
                });
            });
            
            // Make component container sortable
            const sortable = new Sortable(document.getElementById('componentContainer'), {
                animation: 150,
                handle: '.drag-handle',
                onEnd: function() {
                    // Update the preview when components are reordered
                    if (document.querySelector('.tab[data-tab="preview"]').classList.contains('active')) {
                        generatePreview();
                    }
                }
            });
            
            // Form submission
            document.getElementById('scaffoldForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Switch to preview tab
                document.querySelector('.tab[data-tab="design"]').classList.remove('active');
                document.querySelector('.tab[data-tab="preview"]').classList.add('active');
                document.getElementById('design-tab').classList.remove('active');
                document.getElementById('preview-tab').classList.add('active');
                
                // Generate preview
                generatePreview();
            });
            
            // Download button
            document.getElementById('downloadBtn').addEventListener('click', function() {
                generatePDF();
            });
            
            // Send email button
            document.getElementById('sendEmailBtn').addEventListener('click', function() {
                const email = document.getElementById('emailInput').value;
                
                if (!email) {
                    alert('Please enter your email address');
                    return;
                }
                
                // In a real implementation, this would send the email
                // For now, we'll simulate success
                alert(`Your AI Tutoring Assignment Template would be sent to ${email}. This is a demo version without actual email sending functionality. Please download the PDF instead.`);
            });
            
            // Add a component to the container
            function addComponent(type) {
                const template = document.getElementById(`${type}-template`);
                if (!template) return;
                
                const clone = document.importNode(template.content, true);
                const container = document.getElementById('componentContainer');
                container.appendChild(clone);
                
                // Add event listeners to the new component
                const component = container.lastElementChild;
                
                // Remove button
                component.querySelector('.remove-component').addEventListener('click', function() {
                    component.remove();
                    
                    // Update preview if we're on the preview tab
                    if (document.querySelector('.tab[data-tab="preview"]').classList.contains('active')) {
                        generatePreview();
                    }
                });
                
                // Move buttons
                component.querySelector('.move-up').addEventListener('click', function() {
                    const prev = component.previousElementSibling;
                    if (prev) {
                        container.insertBefore(component, prev);
                    }
                    
                    // Update preview if we're on the preview tab
                    if (document.querySelector('.tab[data-tab="preview"]').classList.contains('active')) {
                        generatePreview();
                    }
                });
                
                component.querySelector('.move-down').addEventListener('click', function() {
                    const next = component.nextElementSibling;
                    if (next) {
                        container.insertBefore(next, component);
                    }
                    
                    // Update preview if we're on the preview tab
                    if (document.querySelector('.tab[data-tab="preview"]').classList.contains('active')) {
                        generatePreview();
                    }
                });
            }
            
            // Generate preview
            function generatePreview() {
                const preview = document.getElementById('templatePreview');
                const title = document.getElementById('assignmentTitle').value || 'AI-Enhanced Assignment';
                
                // Basic information
                const courseInfo = document.getElementById('courseInfo').value;
                const disciplineSelect = document.getElementById('disciplineArea');
                let discipline = disciplineSelect.options[disciplineSelect.selectedIndex].text;
                if (discipline === 'Other (specify below)') {
                    discipline = document.getElementById('otherDiscipline').value;
                }
                
                // AI tools
                const selectedTools = [];
                document.querySelectorAll('input[name="aiTools"]:checked').forEach(checkbox => {
                    if (checkbox.value === 'Other') {
                        selectedTools.push(document.getElementById('otherToolInput').value);
                    } else {
                        selectedTools.push(checkbox.value);
                    }
                });
                
                // Build the preview HTML
                let previewHTML = `
                    <h2 class="preview-heading">${title}</h2>
                    <p><strong>Course:</strong> ${courseInfo}</p>
                    <p><strong>Discipline:</strong> ${discipline}</p>
                    <p><strong>Recommended AI Tools:</strong> ${selectedTools.join(', ') || 'None specified'}</p>
                    
                    <h3>Learning Objectives</h3>
                    <p>${document.getElementById('learningObjectives').value.replace(/\n/g, '<br>')}</p>
                    
                    <h3>Tool Selection Rationale</h3>
                    <p>${document.getElementById('toolRationale').value || 'No rationale provided.'}</p>
                    
                    <h3>Assignment Scaffold</h3>
                `;
                
                // Add components
                const components = document.querySelectorAll('#componentContainer .component-container');
                if (components.length > 0) {
                    components.forEach((component, index) => {
                        const type = component.dataset.type;
                        const title = component.querySelector(`input[name="${type}-title"]`).value || 'Untitled Component';
                        
                        previewHTML += `
                            <div class="stage">
                                <h4 class="stage-title">Stage ${index + 1}: ${title}</h4>
                        `;
                        
                        switch (type) {
                            case 'pre-work':
                                previewHTML += `
                                    <p>${component.querySelector('textarea[name="pre-work-description"]').value}</p>
                                `;
                                break;
                                
                            case 'prompt-template':
                                previewHTML += `
                                    <p><strong>Purpose:</strong> ${component.querySelector('textarea[name="prompt-purpose"]').value}</p>
                                    <div class="prompt-box">
                                        <p><strong>Prompt Template:</strong></p>
                                        <p>${component.querySelector('textarea[name="prompt-template"]').value.replace(/\n/g, '<br>')}</p>
                                    </div>
                                    <p><strong>Instructions:</strong> ${component.querySelector('textarea[name="prompt-instructions"]').value}</p>
                                `;
                                break;
                                
                            case 'reflection':
                                previewHTML += `
                                    <p>${component.querySelector('textarea[name="reflection-description"]').value}</p>
                                    <p><strong>Reflection Questions:</strong></p>
                                    <ul>
                                    ${component.querySelector('textarea[name="reflection-questions"]').value.split('\n').map(q => `<li>${q}</li>`).join('')}
                                    </ul>
                                `;
                                break;
                                
                            case 'evaluation':
                                previewHTML += `
                                    <p>${component.querySelector('textarea[name="evaluation-description"]').value}</p>
                                    <p><strong>Evaluation Criteria:</strong></p>
                                    <ul>
                                    ${component.querySelector('textarea[name="evaluation-criteria"]').value.split('\n').map(c => `<li>${c}</li>`).join('')}
                                    </ul>
                                `;
                                break;
                                
                            case 'iteration':
                                previewHTML += `
                                    <p>${component.querySelector('textarea[name="iteration-description"]').value}</p>
                                    <p><strong>Guidance:</strong> ${component.querySelector('textarea[name="iteration-guidance"]').value}</p>
                                `;
                                break;
                                
                            case 'synthesis':
                                previewHTML += `
                                    <p>${component.querySelector('textarea[name="synthesis-description"]').value}</p>
                                    <p><strong>Instructions:</strong> ${component.querySelector('textarea[name="synthesis-instructions"]').value}</p>
                                `;
                                break;
                                
                            case 'custom':
                                previewHTML += `
                                    <p>${component.querySelector('textarea[name="custom-description"]').value}</p>
                                    <p>${component.querySelector('textarea[name="custom-content"]').value.replace(/\n/g, '<br>')}</p>
                                `;
                                break;
                        }
                        
                        previewHTML += `</div>`;
                    });
                } else {
                    previewHTML += `<p><em>No scaffold components added yet. Return to the Design tab to add components.</em></p>`;
                }
                
                // Add guidelines
                previewHTML += `
                    <h3>Guidelines for Students</h3>
                    <p><strong>Ethical Guidelines:</strong></p>
                    <p>${document.getElementById('ethicalGuidelines').value || 'No ethical guidelines provided.'}</p>
                    
                    <p><strong>Attribution Guidelines:</strong></p>
                    <p>${document.getElementById('attributionGuidelines').value || 'No attribution guidelines provided.'}</p>
                `;
                
                // Update preview
                preview.innerHTML = previewHTML;
                document.getElementById('previewTitle').textContent = `${title} Preview`;
            }
            
            // Generate PDF
            function generatePDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                let yPosition = 20;
                
                // Helper function to add text with word wrap
                function addText(text, x, y, maxWidth, lineHeight) {
                    if (!text) return y;
                    const lines = doc.splitTextToSize(text.replace(/<br>/g, '\n'), maxWidth);
                    doc.text(lines, x, y);
                    return y + (lines.length * lineHeight);
                }
                
                // Helper function to add a section header
                function addSectionHeader(text, x, y) {
                    doc.setFontSize(16);
                    doc.setTextColor(44, 62, 80);
                    doc.text(text, x, y);
                    return y + 8;
                }
                
                // Helper function to add a subsection header
                function addSubsectionHeader(text, x, y) {
                    doc.setFontSize(14);
                    doc.setTextColor(44, 62, 80);
                    doc.text(text, x, y);
                    return y + 7;
                }
                
                // Helper function to check and add a new page if needed
                function checkPageBreak(y, margin = 20) {
                    if (y > 270) {
                        doc.addPage();
                        return 20;
                    }
                    return y;
                }
                
                // Title and course info
                const title = document.getElementById('assignmentTitle').value || 'AI-Enhanced Assignment';
                const courseInfo = document.getElementById('courseInfo').value;
                
                doc.setFontSize(20);
                doc.setTextColor(44, 62, 80);
                doc.text(title, 105, yPosition, { align: 'center' });
                yPosition += 10;
                
                if (courseInfo) {
                    doc.setFontSize(14);
                    doc.text(courseInfo, 105, yPosition, { align: 'center' });
                    yPosition += 8;
                }
                
                doc.text(`Generated on ${new Date().toLocaleDateString()}`, 105, yPosition, { align: 'center' });
                yPosition += 15;
                
                // Add divider
                doc.setDrawColor(44, 62, 80);
                doc.line(20, yPosition, 190, yPosition);
                yPosition += 10;
                
                // Learning objectives
                yPosition = addSectionHeader('Learning Objectives', 20, yPosition);
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                yPosition = addText(document.getElementById('learningObjectives').value, 20, yPosition, 170, 6);
                yPosition += 10;
                
                yPosition = checkPageBreak(yPosition);
                
                // AI Tools
                yPosition = addSectionHeader('Recommended AI Tools', 20, yPosition);
                
                const selectedTools = [];
                document.querySelectorAll('input[name="aiTools"]:checked').forEach(checkbox => {
                    if (checkbox.value === 'Other') {
                        selectedTools.push(document.getElementById('otherToolInput').value);
                    } else {
                        selectedTools.push(checkbox.value);
                    }
                });
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                yPosition = addText(selectedTools.join(', ') || 'None specified', 20, yPosition, 170, 6);
                yPosition += 5;
                
                yPosition = addText('Rationale: ' + document.getElementById('toolRationale').value, 20, yPosition, 170, 6);
                yPosition += 10;
                
                yPosition = checkPageBreak(yPosition);
                
                // Assignment Scaffold
                yPosition = addSectionHeader('Assignment Scaffold', 20, yPosition);
                yPosition += 5;
                
                // Add components
                const components = document.querySelectorAll('#componentContainer .component-container');
                if (components.length > 0) {
                    components.forEach((component, index) => {
                        yPosition = checkPageBreak(yPosition);
                        
                        const type = component.dataset.type;
                        const title = component.querySelector(`input[name="${type}-title"]`).value || 'Untitled Component';
                        
                        // Stage header
                        yPosition = addSubsectionHeader(`Stage ${index + 1}: ${title}`, 20, yPosition);
                        doc.setFontSize(12);
                        doc.setTextColor(0, 0, 0);
                        
                        switch (type) {
                            case 'pre-work':
                                yPosition = addText(component.querySelector('textarea[name="pre-work-description"]').value, 20, yPosition, 170, 6);
                                break;
                                
                            case 'prompt-template':
                                doc.text('Purpose:', 20, yPosition);
                                yPosition += 5;
                                yPosition = addText(component.querySelector('textarea[name="prompt-purpose"]').value, 25, yPosition, 165, 6);
                                yPosition += 5;
                                
                                doc.text('Prompt Template:', 20, yPosition);
                                yPosition += 5;
                                
                                // Draw prompt box
                                doc.setFillColor(245, 245, 245);
                                doc.rect(20, yPosition, 170, 30, 'F');
                                yPosition = addText(component.querySelector('textarea[name="prompt-template"]').value, 25, yPosition + 5, 160, 6);
                                yPosition += 10;
                                
                                doc.text('Instructions:', 20, yPosition);
                                yPosition += 5;
                                yPosition = addText(component.querySelector('textarea[name="prompt-instructions"]').value, 25, yPosition, 165, 6);
                                break;
                                
                            case 'reflection':
                                yPosition = addText(component.querySelector('textarea[name="reflection-description"]').value, 20, yPosition, 170, 6);
                                yPosition += 5;
                                
                                doc.text('Reflection Questions:', 20, yPosition);
                                yPosition += 5;
                                
                                // Add reflection questions as bullets
                                const questions = component.querySelector('textarea[name="reflection-questions"]').value.split('\n');
                                questions.forEach(question => {
                                    if (question.trim()) {
                                        yPosition = checkPageBreak(yPosition);
                                        doc.text('• ', 25, yPosition);
                                        yPosition = addText(question, 30, yPosition, 160, 6);
                                        yPosition += 2;
                                    }
                                });
                                break;
                                
                            case 'evaluation':
                                yPosition = addText(component.querySelector('textarea[name="evaluation-description"]').value, 20, yPosition, 170, 6);
                                yPosition += 5;
                                
                                doc.text('Evaluation Criteria:', 20, yPosition);
                                yPosition += 5;
                                
                                // Add evaluation criteria as bullets
                                const criteria = component.querySelector('textarea[name="evaluation-criteria"]').value.split('\n');
                                criteria.forEach(criterion => {
                                    if (criterion.trim()) {
                                        yPosition = checkPageBreak(yPosition);
                                        doc.text('• ', 25, yPosition);
                                        yPosition = addText(criterion, 30, yPosition, 160, 6);
                                        yPosition += 2;
                                    }
                                });
                                break;
                                
                            case 'iteration':
                                yPosition = addText(component.querySelector('textarea[name="iteration-description"]').value, 20, yPosition, 170, 6);
                                yPosition += 5;
                                
                                doc.text('Guidance:', 20, yPosition);
                                yPosition += 5;
                                yPosition = addText(component.querySelector('textarea[name="iteration-guidance"]').value, 25, yPosition, 165, 6);
                                break;
                                
                            case 'synthesis':
                                yPosition = addText(component.querySelector('textarea[name="synthesis-description"]').value, 20, yPosition, 170, 6);
                                yPosition += 5;
                                
                                doc.text('Instructions:', 20, yPosition);
                                yPosition += 5;
                                yPosition = addText(component.querySelector('textarea[name="synthesis-instructions"]').value, 25, yPosition, 165, 6);
                                break;
                                
                            case 'custom':
                                yPosition = addText(component.querySelector('textarea[name="custom-description"]').value, 20, yPosition, 170, 6);
                                yPosition += 5;
                                yPosition = addText(component.querySelector('textarea[name="custom-content"]').value, 20, yPosition, 170, 6);
                                break;
                        }
                        
                        yPosition += 10;
                    });
                } else {
                    yPosition = addText('No scaffold components added.', 20, yPosition, 170, 6);
                    yPosition += 10;
                }
                
                yPosition = checkPageBreak(yPosition);
                
                // Guidelines
                yPosition = addSectionHeader('Guidelines for Students', 20, yPosition);
                yPosition += 5;
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text('Ethical Guidelines:', 20, yPosition);
                yPosition += 5;
                yPosition = addText(document.getElementById('ethicalGuidelines').value || 'No ethical guidelines provided.', 25, yPosition, 165, 6);
                yPosition += 10;
                
                yPosition = checkPageBreak(yPosition);
                
                doc.text('Attribution Guidelines:', 20, yPosition);
                yPosition += 5;
                yPosition = addText(document.getElementById('attributionGuidelines').value || 'No attribution guidelines provided.', 25, yPosition, 165, 6);
                
                // Save the PDF
                const titleForFilename = title.replace(/[^a-z0-9]/gi, '_').toLowerCase();
                doc.save(`${titleForFilename}_ai_assignment.pdf`);
            }
            
            // Add an initial component as an example
            addComponent('prompt-template');
        });
    </script>
</body>
</html>
